<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenSSL::PKey::DH
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!OpenSSL/PKey/DH.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (D)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../PKey.html" title="OpenSSL::PKey (module)">PKey</a></span></span>
     &raquo; 
    <span class="title">DH</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenSSL::PKey::DH
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName">PKey</span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">PKey</li>
          
            <li class="next">OpenSSL::PKey::DH</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/openssl/ossl_pkey_dh.c<span class="defines">,<br />
  ext/openssl/ossl_pkey_dh.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An implementation of the Diffie-Hellman key exchange protocol based on
discrete logarithms in finite fields, the same basis that DSA is built on.</p>

<h3 id="label-Accessor+methods+for+the+Diffie-Hellman+parameters">Accessor methods for the Diffie-Hellman parameters</h3>
<ul><li>
<p>DH#p</p>
</li></ul>

<p>The prime (an OpenSSL::BN) of the Diffie-Hellman parameters.</p>
<ul><li>
<p>DH#g</p>
</li></ul>

<p>The generator (an OpenSSL::BN) g of the Diffie-Hellman parameters.</p>
<ul><li>
<p>DH#pub_key</p>
</li></ul>

<p>The per-session public key (an OpenSSL::BN) matching the private key. This
needs to be passed to DH#compute_key.</p>
<ul><li>
<p>DH#priv_key</p>
</li></ul>

<p>The per-session private key, an OpenSSL::BN.</p>

<h3 id="label-Example+of+a+key+exchange">Example of a key exchange</h3>

<pre class="ruby"><span class="ruby-identifier">dh1</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">DH</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2048</span>)
<span class="ruby-identifier">params</span> = <span class="ruby-identifier">dh1</span>.<span class="ruby-identifier">public_key</span>.<span class="ruby-identifier">to_der</span> <span class="ruby-comment">#you may send this publicly to the participating party</span>
<span class="ruby-identifier">dh2</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">DH</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">der</span>)
<span class="ruby-identifier">dh2</span>.<span class="ruby-identifier">generate_key!</span> <span class="ruby-comment">#generate the per-session key pair</span>
<span class="ruby-identifier">symm_key1</span> = <span class="ruby-identifier">dh1</span>.<span class="ruby-identifier">compute_key</span>(<span class="ruby-identifier">dh2</span>.<span class="ruby-identifier">pub_key</span>)
<span class="ruby-identifier">symm_key2</span> = <span class="ruby-identifier">dh2</span>.<span class="ruby-identifier">compute_key</span>(<span class="ruby-identifier">dh1</span>.<span class="ruby-identifier">pub_key</span>)

<span class="ruby-identifier">puts</span> <span class="ruby-identifier">symm_key1</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">symm_key2</span> <span class="ruby-comment"># =&gt; true</span>
</pre>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate-class_method" title="generate (class method)">+ (Object) <strong>generate</strong>(size[, generator]) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new DH instance from scratch by generating the private and public
components alike.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#compute_key-instance_method" title="#compute_key (instance method)">- (aString) <strong>compute_key</strong>(pub_bn) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a String containing a shared secret computed from the other party’s
public value.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#export-instance_method" title="#to_pem (instance method)">- (aString) <strong>to_pem</strong> </a>
    

    
      (also: #to_pem, #to_s)
    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes this DH to its PEM encoding.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#generate_key%21-instance_method" title="#generate_key! (instance method)">- (self) <strong>generate_key!</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Generates a private and public key unless a private key already exists.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#new (instance method)">- (Object) <strong>new</strong>([size [, generator] | string]) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Either generates a DH instance from scratch or by reading already existing
DH parameters from <code>string</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#params-instance_method" title="#params (instance method)">- (Hash) <strong>params</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Stores all parameters of key to the hash INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don’t use :-)) (I’s up to you).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#params_ok%3F-instance_method" title="#check_params (instance method)">- (Boolean) <strong>check_params</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Validates the Diffie-Hellman parameters associated with this instance.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#private%3F-instance_method" title="#private? (instance method)">- (Boolean) <strong>private?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Indicates whether this DH instance has a private key associated with it or
not.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#public%3F-instance_method" title="#public? (instance method)">- (Boolean) <strong>public?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Indicates whether this DH instance has a public key associated with it or
not.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#public_key-instance_method" title="#public_key (instance method)">- (Object) <strong>public_key</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a new DH instance that carries just the public information, i.e.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_der-instance_method" title="#to_der (instance method)">- (aString) <strong>to_der</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Encodes this DH to its DER encoding.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#to_text-instance_method" title="#to_text (instance method)">- (aString) <strong>to_text</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Prints all parameters of key to buffer INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don’t use :-)) (I’s up to you).</p>
</div></span>
  
</li>

      
    </ul>
  


  <div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>new</strong>([size [, generator] | string]) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Either generates a DH instance from scratch or by reading already existing
DH parameters from <code>string</code>. Note that when reading a DH
instance from data that was encoded from a DH instance by using DH#to_pem
or DH#to_der the result will <strong>not</strong> contain a public/private
key pair yet. This needs to be generated using DH#generate_key! first.</p>

<h3 id="label-Parameters">Parameters</h3>
<ul><li>
<p><code>size</code> is an integer representing the desired key size. Keys
smaller than 1024 bits should be considered insecure.</p>
</li><li>
<p><code>generator</code> is a small number &gt; 1, typically 2 or 5.</p>
</li><li>
<p><code>string</code> contains the DER or PEM encoded key.</p>
</li></ul>

<h3 id="label-Examples">Examples</h3>

<p>DH.new # -&gt; dh DH.new(1024) # -&gt; dh DH.new(1024, 5) # -&gt; dh
#Reading DH parameters dh = DH.new(File.read(‘parameters.pem’)) # -&gt; dh,
but no public/private key yet dh.generate_key! # -&gt; dh with public and
private key</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 157</span>

static VALUE
ossl_dh_initialize(int argc, VALUE *argv, VALUE self)
{
    EVP_PKEY *pkey;
    DH *dh;
    int g = 2;
    BIO *in;
    VALUE arg, gen;

    GetPKey(self, pkey);
    if(rb_scan_args(argc, argv, &quot;02&quot;, &amp;arg, &amp;gen) == 0) {
      dh = DH_new();
    }
    else if (FIXNUM_P(arg)) {
	if (!NIL_P(gen)) {
	    g = NUM2INT(gen);
	}
	if (!(dh = dh_generate(FIX2INT(arg), g))) {
	    ossl_raise(eDHError, NULL);
	}
    }
    else {
	arg = ossl_to_der_if_possible(arg);
	in = ossl_obj2bio(arg);
	dh = PEM_read_bio_DHparams(in, NULL, NULL, NULL);
	if (!dh){
	    OSSL_BIO_reset(in);
	    dh = d2i_DHparams_bio(in, NULL);
	}
	BIO_free(in);
	if (!dh) {
	    ossl_raise(eDHError, NULL);
	}
    }
    if (!EVP_PKEY_assign_DH(pkey, dh)) {
	DH_free(dh);
	ossl_raise(eDHError, NULL);
    }
    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="generate-class_method">
  
    + (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>generate</strong>(size[, generator]) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new DH instance from scratch by generating the private and public
components alike.</p>

<h3 id="label-Parameters">Parameters</h3>
<ul><li>
<p><code>size</code> is an integer representing the desired key size. Keys
smaller than 1024 bits should be considered insecure.</p>
</li><li>
<p><code>generator</code> is a small number &gt; 1, typically 2 or 5.</p>
</li></ul>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 114</span>

static VALUE
ossl_dh_s_generate(int argc, VALUE *argv, VALUE klass)
{
    DH *dh ;
    int g = 2;
    VALUE size, gen, obj;

    if (rb_scan_args(argc, argv, &quot;11&quot;, &amp;size, &amp;gen) == 2) {
	g = NUM2INT(gen);
    }
    dh = dh_generate(NUM2INT(size), g);
    obj = dh_instance(klass, dh);
    if (obj == Qfalse) {
	DH_free(dh);
	ossl_raise(eDHError, NULL);
    }

    return obj;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="compute_key-instance_method">
  
    - (<tt>aString</tt>) <strong>compute_key</strong>(pub_bn) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a String containing a shared secret computed from the other party’s
public value. See DH_compute_key() for further information.</p>

<h3 id="label-Parameters">Parameters</h3>
<ul><li>
<p><code>pub_bn</code> is a OpenSSL::BN, <strong>not</strong> the DH instance
returned by</p>
</li></ul>

<p>DH#public_key as that contains the DH parameters only.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>aString</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 448</span>

static VALUE
ossl_dh_compute_key(VALUE self, VALUE pub)
{
    DH *dh;
    EVP_PKEY *pkey;
    BIGNUM *pub_key;
    VALUE str;
    int len;

    GetPKeyDH(self, pkey);
    dh = pkey-&gt;pkey.dh;
    pub_key = GetBNPtr(pub);
    len = DH_size(dh);
    str = rb_str_new(0, len);
    if ((len = DH_compute_key((unsigned char *)RSTRING_PTR(str), pub_key, dh)) &lt; 0) {
	ossl_raise(eDHError, NULL);
    }
    rb_str_set_len(str, len);

    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="export-instance_method">
  
    - (<tt>aString</tt>) <strong>to_pem</strong> 
  

  
    <span class="aliases">Also known as:
    <span class="names"><span id='to_pem-instance_method'>to_pem</span>, <span id='to_s-instance_method'>to_s</span></span>
    </span>
  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes this DH to its PEM encoding. Note that any existing per-session
public/private keys will <strong>not</strong> get encoded, just the
Diffie-Hellman parameters will be encoded.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>aString</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 240</span>

static VALUE
ossl_dh_export(VALUE self)
{
    EVP_PKEY *pkey;
    BIO *out;
    VALUE str;

    GetPKeyDH(self, pkey);
    if (!(out = BIO_new(BIO_s_mem()))) {
	ossl_raise(eDHError, NULL);
    }
    if (!PEM_write_bio_DHparams(out, pkey-&gt;pkey.dh)) {
	BIO_free(out);
	ossl_raise(eDHError, NULL);
    }
    str = ossl_membio2str(out);

    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="generate_key!-instance_method">
  
    - (<tt>self</tt>) <strong>generate_key!</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Generates a private and public key unless a private key already exists. If
this DH instance was generated from public DH parameters (e.g. by encoding
the result of DH#public_key), then this method needs to be called first in
order to generate the per-session keys before performing the actual key
exchange.</p>

<h3 id="label-Example">Example</h3>

<pre class="ruby"><span class="ruby-identifier">dh</span> = <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">PKey</span><span class="ruby-operator">::</span><span class="ruby-constant">DH</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">2048</span>)
<span class="ruby-identifier">public_key</span> = <span class="ruby-identifier">dh</span>.<span class="ruby-identifier">public_key</span> <span class="ruby-comment">#contains no private/public key yet</span>
<span class="ruby-identifier">public_key</span>.<span class="ruby-identifier">generate_key!</span>
<span class="ruby-identifier">puts</span> <span class="ruby-identifier">public_key</span>.<span class="ruby-identifier">private?</span> <span class="ruby-comment"># =&gt; true</span>
</pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


423
424
425
426
427
428
429
430
431
432
433
434
435</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 423</span>

static VALUE
ossl_dh_generate_key(VALUE self)
{
    DH *dh;
    EVP_PKEY *pkey;

    GetPKeyDH(self, pkey);
    dh = pkey-&gt;pkey.dh;

    if (!DH_generate_key(dh))
	ossl_raise(eDHError, &quot;Failed to generate key&quot;);
    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="params-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>) <strong>params</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Stores all parameters of key to the hash INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don’t use :-)) (I’s up to you)</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 297</span>

static VALUE
ossl_dh_get_params(VALUE self)
{
    EVP_PKEY *pkey;
    VALUE hash;

    GetPKeyDH(self, pkey);

    hash = rb_hash_new();

    rb_hash_aset(hash, rb_str_new2(&quot;p&quot;), ossl_bn_new(pkey-&gt;pkey.dh-&gt;p));
    rb_hash_aset(hash, rb_str_new2(&quot;g&quot;), ossl_bn_new(pkey-&gt;pkey.dh-&gt;g));
    rb_hash_aset(hash, rb_str_new2(&quot;pub_key&quot;), ossl_bn_new(pkey-&gt;pkey.dh-&gt;pub_key));
    rb_hash_aset(hash, rb_str_new2(&quot;priv_key&quot;), ossl_bn_new(pkey-&gt;pkey.dh-&gt;priv_key));

    return hash;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="params_ok?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>check_params</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Validates the Diffie-Hellman parameters associated with this instance. It
checks whether a safe prime and a suitable generator are used. If this is
not the case, <code>false</code> is returned.</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 390</span>

static VALUE
ossl_dh_check_params(VALUE self)
{
    DH *dh;
    EVP_PKEY *pkey;
    int codes;

    GetPKeyDH(self, pkey);
    dh = pkey-&gt;pkey.dh;

    if (!DH_check(dh, &amp;codes)) {
	return Qfalse;
    }

    return codes == 0 ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="private?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>private?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Indicates whether this DH instance has a private key associated with it or
not. The private key may be retrieved with DH#priv_key.</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


222
223
224
225
226
227
228
229
230</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 222</span>

static VALUE
ossl_dh_is_private(VALUE self)
{
    EVP_PKEY *pkey;

    GetPKeyDH(self, pkey);

    return (DH_PRIVATE(pkey-&gt;pkey.dh)) ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="public?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>public?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Indicates whether this DH instance has a public key associated with it or
not. The public key may be retrieved with DH#pub_key.</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


205
206
207
208
209
210
211
212
213</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 205</span>

static VALUE
ossl_dh_is_public(VALUE self)
{
    EVP_PKEY *pkey;

    GetPKeyDH(self, pkey);

    return (pkey-&gt;pkey.dh-&gt;pub_key) ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="public_key-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>public_key</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a new DH instance that carries just the public information, i.e.
the prime <code>p</code> and the generator <code>g</code>, but no
public/private key yet. Such a pair may be generated using
DH#generate_key!. The “public key” needed for a key exchange with
DH#compute_key is considered as per-session information and may be
retrieved with DH#pub_key once a key pair has been generated. If the
current instance already contains private information (and thus a valid
public/private key pair), this information will no longer be present in the
new instance generated by DH#public_key. This feature is helpful for
publishing the Diffie-Hellman parameters without leaking any of the private
per-session information.</p>

<h3 id="label-Example">Example</h3>

<p>dh = OpenSSL::PKey::DH.new(2048) # has public and private key set
public_key = dh.public_key # contains only prime and generator parameters =
public_key.to_der # it’s safe to publish this</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 364</span>

static VALUE
ossl_dh_to_public_key(VALUE self)
{
    EVP_PKEY *pkey;
    DH *dh;
    VALUE obj;

    GetPKeyDH(self, pkey);
    dh = DHparams_dup(pkey-&gt;pkey.dh); /* err check perfomed by dh_instance */
    obj = dh_instance(CLASS_OF(self), dh);
    if (obj == Qfalse) {
	DH_free(dh);
	ossl_raise(eDHError, NULL);
    }

    return obj;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_der-instance_method">
  
    - (<tt>aString</tt>) <strong>to_der</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Encodes this DH to its DER encoding. Note that any existing per-session
public/private keys will <strong>not</strong> get encoded, just the
Diffie-Hellman parameters will be encoded.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>aString</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 269</span>

static VALUE
ossl_dh_to_der(VALUE self)
{
    EVP_PKEY *pkey;
    unsigned char *p;
    long len;
    VALUE str;

    GetPKeyDH(self, pkey);
    if((len = i2d_DHparams(pkey-&gt;pkey.dh, NULL)) &lt;= 0)
	ossl_raise(eDHError, NULL);
    str = rb_str_new(0, len);
    p = (unsigned char *)RSTRING_PTR(str);
    if(i2d_DHparams(pkey-&gt;pkey.dh, &amp;p) &lt; 0)
	ossl_raise(eDHError, NULL);
    ossl_str_adjust(str, p);

    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="to_text-instance_method">
  
    - (<tt>aString</tt>) <strong>to_text</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Prints all parameters of key to buffer INSECURE: PRIVATE INFORMATIONS CAN
LEAK OUT!!! Don’t use :-)) (I’s up to you)</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>aString</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_pkey_dh.c', line 323</span>

static VALUE
ossl_dh_to_text(VALUE self)
{
    EVP_PKEY *pkey;
    BIO *out;
    VALUE str;

    GetPKeyDH(self, pkey);
    if (!(out = BIO_new(BIO_s_mem()))) {
	ossl_raise(eDHError, NULL);
    }
    if (!DHparams_print(out, pkey-&gt;pkey.dh)) {
	BIO_free(out);
	ossl_raise(eDHError, NULL);
    }
    str = ossl_membio2str(out);

    return str;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 19 10:17:09 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.9.3).
</div>

  </body>
</html>