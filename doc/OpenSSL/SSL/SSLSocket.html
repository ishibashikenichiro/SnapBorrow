<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenSSL::SSL::SSLSocket
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!OpenSSL/SSL/SSLSocket.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../SSL.html" title="OpenSSL::SSL (module)">SSL</a></span></span>
     &raquo; 
    <span class="title">SSLSocket</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenSSL::SSL::SSLSocket
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">OpenSSL::SSL::SSLSocket</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/openssl/ossl_ssl.c<span class="defines">,<br />
  ext/openssl/ossl_ssl.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>The following attributes are available but don’t show up in rdoc.</p>
<ul><li>
<p>io, context, sync_close</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div>






  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#accept-instance_method" title="#accept (instance method)">- (self) <strong>accept</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Waits for a SSL/TLS client to initiate a handshake.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#accept_nonblock-instance_method" title="#accept_nonblock (instance method)">- (self) <strong>accept_nonblock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initiates the SSL/TLS handshake as a server in non-blocking manner.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cert-instance_method" title="#cert (instance method)">- (nil) <strong>cert</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The X509 certificate for this socket endpoint.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#cipher-instance_method" title="#cipher (instance method)">- (Array) <strong>cipher</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The cipher being used for the current connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#client_ca-instance_method" title="#client_ca (instance method)">- (Array) <strong>client_ca</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the list of client CAs.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect-instance_method" title="#connect (instance method)">- (self) <strong>connect</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initiates an SSL/TLS handshake with a server.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#connect_nonblock-instance_method" title="#connect_nonblock (instance method)">- (self) <strong>connect_nonblock</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Initiates the SSL/TLS handshake as a client in non-blocking manner.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Object) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates a new SSL socket from <code>io</code> which must be a real ruby
object (not an IO-like object that responds to read/write.</p>

<pre class="ruby"><span class="ruby-constant">If</span> <span class="ruby-operator">+</span><span class="ruby-identifier">ctx</span><span class="ruby-operator">+</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">provided</span> <span class="ruby-identifier">the</span> <span class="ruby-constant">SSL</span> <span class="ruby-constant">Sockets</span> <span class="ruby-identifier">initial</span> <span class="ruby-identifier">params</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">be</span> <span class="ruby-identifier">taken</span> <span class="ruby-identifier">from</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">context</span>.
<span class="ruby-constant">The</span> <span class="ruby-constant">OpenSSL</span><span class="ruby-operator">::</span><span class="ruby-constant">Buffering</span> <span class="ruby-keyword">module</span> <span class="ruby-identifier">provides</span> <span class="ruby-identifier">additional</span> <span class="ruby-constant">IO</span> <span class="ruby-identifier">methods</span>.
<span class="ruby-constant">This</span> <span class="ruby-identifier">method</span> <span class="ruby-identifier">will</span> <span class="ruby-identifier">freeze</span> <span class="ruby-identifier">the</span> <span class="ruby-constant">SSLContext</span> <span class="ruby-keyword">if</span> <span class="ruby-identifier">one</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">provided</span>; <span class="ruby-identifier">however</span>, <span class="ruby-identifier">session</span> <span class="ruby-identifier">management</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">still</span> <span class="ruby-identifier">allowed</span> <span class="ruby-keyword">in</span> <span class="ruby-identifier">the</span> <span class="ruby-identifier">frozen</span> <span class="ruby-constant">SSLContext</span><span class="ruby-operator">..</span>
</pre>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#peer_cert-instance_method" title="#peer_cert (instance method)">- (nil) <strong>peer_cert</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The X509 certificate for this socket’s peer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#peer_cert_chain-instance_method" title="#peer_cert_chain (instance method)">- (Array<sup>?</sup>) <strong>peer_cert_chain</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The X509 certificate chain for this socket’s peer.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#pending-instance_method" title="#pending (instance method)">- (Integer) <strong>pending</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The number of bytes that are immediately available for reading.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session%3D-instance_method" title="#session= (instance method)">- (Object) <strong>session=</strong>(session) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the Session to be used when the connection is established.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_reused%3F-instance_method" title="#session_reused? (instance method)">- (Boolean) <strong>session_reused?</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns true if a reused session was negotiated during the handshake.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#state-instance_method" title="#state (instance method)">- (String) <strong>state</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>A description of the current connection state.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sysclose-instance_method" title="#sysclose (instance method)">- (nil) <strong>sysclose</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Shuts down the SSL connection and prepares it for another connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#sysread-instance_method" title="#sysread (instance method)">- (Object) <strong>sysread</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Reads <code>length</code> bytes from the SSL connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#syswrite-instance_method" title="#syswrite (instance method)">- (Integer) <strong>syswrite</strong>(string) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Writes <code>string</code> to the SSL connection.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#verify_result-instance_method" title="#verify_result (instance method)">- (Integer) <strong>verify_result</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the result of the peer certificates verification.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    
      <span class="overload">- (<tt>aSSLSocket</tt>) <strong>new</strong>(io) </span>
    
      <span class="overload">- (<tt>aSSLSocket</tt>) <strong>new</strong>(io, ctx) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates a new SSL socket from <code>io</code> which must be a real ruby
object (not an IO-like object that responds to read/write.</p>

<p>If <code>ctx</code> is provided the SSL Sockets initial params will be
taken from the context.</p>

<p>The OpenSSL::Buffering module provides additional IO methods.</p>

<p>This method will freeze the SSLContext if one is provided; however, session
management is still allowed in the frozen SSLContext.</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>aSSLSocket</tt>) <strong>new</strong>(io) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>aSSLSocket</tt>) <strong>new</strong>(io, ctx) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1023
1024
1025
1026
1027
1028
1029
1030
1031
1032
1033
1034
1035
1036
1037
1038
1039
1040
1041
1042
1043</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1023</span>

static VALUE
ossl_ssl_initialize(int argc, VALUE *argv, VALUE self)
{
    VALUE io, ctx;

    if (rb_scan_args(argc, argv, &quot;11&quot;, &amp;io, &amp;ctx) == 1) {
        ctx = rb_funcall(cSSLContext, rb_intern(&quot;new&quot;), 0);
    }
    OSSL_Check_Kind(ctx, cSSLContext);
    Check_Type(io, T_FILE);
    ossl_ssl_set_io(self, io);
    ossl_ssl_set_ctx(self, ctx);
    ossl_ssl_set_sync_close(self, Qfalse);
    ossl_sslctx_setup(ctx);

    rb_iv_set(self, &quot;@hostname&quot;, Qnil);

    rb_call_super(0, 0);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="accept-instance_method">
  
    - (<tt>self</tt>) <strong>accept</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Waits for a SSL/TLS client to initiate a handshake.  The handshake may be
started after unencrypted data has been sent over the socket.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1205
1206
1207
1208
1209
1210</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1205</span>

static VALUE
ossl_ssl_accept(VALUE self)
{
    ossl_ssl_setup(self);
    return ossl_start_ssl(self, SSL_accept, &quot;SSL_accept&quot;, 0);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="accept_nonblock-instance_method">
  
    - (<tt>self</tt>) <strong>accept_nonblock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initiates the SSL/TLS handshake as a server in non-blocking manner.</p>

<pre class="code"><code class=""><span class='comment'># emulates blocking accept
</span><span class='kw'>begin</span>
  <span class='id identifier rubyid_ssl'>ssl</span><span class='period'>.</span><span class='id identifier rubyid_accept_nonblock'>accept_nonblock</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitReadable</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_s2'>s2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>retry</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitWritable</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_s2'>s2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>retry</span>
<span class='kw'>end</span></code></pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1230
1231
1232
1233
1234
1235</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1230</span>

static VALUE
ossl_ssl_accept_nonblock(VALUE self)
{
    ossl_ssl_setup(self);
    return ossl_start_ssl(self, SSL_accept, &quot;SSL_accept&quot;, 1);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cert-instance_method">
  
    - (<tt>nil</tt>) <strong>cert</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The X509 certificate for this socket endpoint.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1427
1428
1429
1430
1431
1432
1433
1434
1435
1436
1437
1438
1439
1440
1441
1442
1443
1444
1445
1446
1447
1448
1449</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1427</span>

static VALUE
ossl_ssl_get_cert(VALUE self)
{
    SSL *ssl;
    X509 *cert = NULL;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }

    /*
     * Is this OpenSSL bug? Should add a ref?
     * TODO: Ask for.
     */
    cert = SSL_get_certificate(ssl); /* NO DUPs =&gt; DON'T FREE. */

    if (!cert) {
        return Qnil;
    }
    return ossl_x509_new(cert);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="cipher-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>) <strong>cipher</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The cipher being used for the current connection</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1520
1521
1522
1523
1524
1525
1526
1527
1528
1529
1530
1531
1532
1533
1534</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1520</span>

static VALUE
ossl_ssl_get_cipher(VALUE self)
{
    SSL *ssl;
    SSL_CIPHER *cipher;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }
    cipher = (SSL_CIPHER *)SSL_get_current_cipher(ssl);

    return ossl_ssl_cipher_to_ary(cipher);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="client_ca-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>) <strong>client_ca</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the list of client CAs. Please note that in contrast to
SSLContext#client_ca= no array of X509::Certificate is returned but
X509::Name instances of the CA’s subject distinguished name.</p>

<p>In server mode, returns the list set by SSLContext#client_ca=. In client
mode, returns the list of client CAs sent from the server.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1668
1669
1670
1671
1672
1673
1674
1675
1676
1677
1678
1679
1680
1681
1682</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1668</span>

static VALUE
ossl_ssl_get_client_ca_list(VALUE self)
{
    SSL *ssl;
    STACK_OF(X509_NAME) *ca;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
	rb_warning(&quot;SSL session is not started yet.&quot;);
	return Qnil;
    }

    ca = SSL_get_client_CA_list(ssl);
    return ossl_x509name_sk2ary(ca);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connect-instance_method">
  
    - (<tt>self</tt>) <strong>connect</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initiates an SSL/TLS handshake with a server.  The handshake may be started
after unencrypted data has been sent over the socket.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1166
1167
1168
1169
1170
1171</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1166</span>

static VALUE
ossl_ssl_connect(VALUE self)
{
    ossl_ssl_setup(self);
    return ossl_start_ssl(self, SSL_connect, &quot;SSL_connect&quot;, 0);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="connect_nonblock-instance_method">
  
    - (<tt>self</tt>) <strong>connect_nonblock</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Initiates the SSL/TLS handshake as a client in non-blocking manner.</p>

<pre class="code"><code class=""><span class='comment'># emulates blocking connect
</span><span class='kw'>begin</span>
  <span class='id identifier rubyid_ssl'>ssl</span><span class='period'>.</span><span class='id identifier rubyid_connect_nonblock'>connect_nonblock</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitReadable</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='lbracket'>[</span><span class='id identifier rubyid_s2'>s2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>retry</span>
<span class='kw'>rescue</span> <span class='const'>IO</span><span class='op'>::</span><span class='const'>WaitWritable</span>
  <span class='const'>IO</span><span class='period'>.</span><span class='id identifier rubyid_select'>select</span><span class='lparen'>(</span><span class='kw'>nil</span><span class='comma'>,</span> <span class='lbracket'>[</span><span class='id identifier rubyid_s2'>s2</span><span class='rbracket'>]</span><span class='rparen'>)</span>
  <span class='kw'>retry</span>
<span class='kw'>end</span></code></pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1191
1192
1193
1194
1195
1196</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1191</span>

static VALUE
ossl_ssl_connect_nonblock(VALUE self)
{
    ossl_ssl_setup(self);
    return ossl_start_ssl(self, SSL_connect, &quot;SSL_connect&quot;, 1);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="peer_cert-instance_method">
  
    - (<tt>nil</tt>) <strong>peer_cert</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The X509 certificate for this socket’s peer.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1457
1458
1459
1460
1461
1462
1463
1464
1465
1466
1467
1468
1469
1470
1471
1472
1473
1474
1475
1476
1477
1478
1479
1480</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1457</span>

static VALUE
ossl_ssl_get_peer_cert(VALUE self)
{
    SSL *ssl;
    X509 *cert = NULL;
    VALUE obj;

    Data_Get_Struct(self, SSL, ssl);

    if (!ssl){
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }

    cert = SSL_get_peer_certificate(ssl); /* Adds a ref =&gt; Safe to FREE. */

    if (!cert) {
        return Qnil;
    }
    obj = ossl_x509_new(cert);
    X509_free(cert);

    return obj;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="peer_cert_chain-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt><sup>?</sup>) <strong>peer_cert_chain</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The X509 certificate chain for this socket’s peer.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1488
1489
1490
1491
1492
1493
1494
1495
1496
1497
1498
1499
1500
1501
1502
1503
1504
1505
1506
1507
1508
1509
1510
1511
1512</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1488</span>

static VALUE
ossl_ssl_get_peer_cert_chain(VALUE self)
{
    SSL *ssl;
    STACK_OF(X509) *chain;
    X509 *cert;
    VALUE ary;
    int i, num;

    Data_Get_Struct(self, SSL, ssl);
    if(!ssl){
	rb_warning(&quot;SSL session is not started yet.&quot;);
	return Qnil;
    }
    chain = SSL_get_peer_cert_chain(ssl);
    if(!chain) return Qnil;
    num = sk_X509_num(chain);
    ary = rb_ary_new2(num);
    for (i = 0; i &lt; num; i++){
	cert = sk_X509_value(chain, i);
	rb_ary_push(ary, ossl_x509_new(cert));
    }

    return ary;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="pending-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>pending</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The number of bytes that are immediately available for reading</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1567
1568
1569
1570
1571
1572
1573
1574
1575
1576
1577
1578
1579</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1567</span>

static VALUE
ossl_ssl_pending(VALUE self)
{
    SSL *ssl;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }

    return INT2NUM(SSL_pending(ssl));
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>session=</strong>(session) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the Session to be used when the connection is established.</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1611
1612
1613
1614
1615
1616
1617
1618
1619
1620
1621
1622
1623
1624
1625
1626
1627
1628
1629
1630
1631
1632</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1611</span>

static VALUE
ossl_ssl_set_session(VALUE self, VALUE arg1)
{
    SSL *ssl;
    SSL_SESSION *sess;

/* why is ossl_ssl_setup delayed? */
    ossl_ssl_setup(self);

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }

    SafeGetSSLSession(arg1, sess);

    if (SSL_set_session(ssl, sess) != 1)
        ossl_raise(eSSLError, &quot;SSL_set_session&quot;);

    return arg1;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_reused?-instance_method">
  
    - (<tt>Boolean</tt>) <strong>session_reused?</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns true if a reused session was negotiated during the handshake.</p>


  </div>
</div>
<div class="tags">
  
  

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Boolean</tt>)</span>
      
      
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1587
1588
1589
1590
1591
1592
1593
1594
1595
1596
1597
1598
1599
1600
1601
1602
1603</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1587</span>

static VALUE
ossl_ssl_session_reused(VALUE self)
{
    SSL *ssl;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }

    switch(SSL_session_reused(ssl)) {
    case 1:	return Qtrue;
    case 0:	return Qfalse;
    default:	ossl_raise(eSSLError, &quot;SSL_session_reused&quot;);
    }
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="state-instance_method">
  
    - (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>state</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>A description of the current connection state.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1542
1543
1544
1545
1546
1547
1548
1549
1550
1551
1552
1553
1554
1555
1556
1557
1558
1559</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1542</span>

static VALUE
ossl_ssl_get_state(VALUE self)
{
    SSL *ssl;
    VALUE ret;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }
    ret = rb_str_new2(SSL_state_string(ssl));
    if (ruby_verbose) {
        rb_str_cat2(ret, &quot;: &quot;);
        rb_str_cat2(ret, SSL_state_string_long(ssl));
    }
    return ret;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sysclose-instance_method">
  
    - (<tt>nil</tt>) <strong>sysclose</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Shuts down the SSL connection and prepares it for another connection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1401
1402
1403
1404
1405
1406
1407
1408
1409
1410
1411
1412
1413
1414
1415
1416
1417
1418
1419</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1401</span>

static VALUE
ossl_ssl_close(VALUE self)
{
    SSL *ssl;

    Data_Get_Struct(self, SSL, ssl);
    if (ssl) {
	VALUE io = ossl_ssl_get_io(self);
	if (!RTEST(rb_funcall(io, rb_intern(&quot;closed?&quot;), 0))) {
	    ossl_ssl_shutdown(ssl);
	    SSL_free(ssl);
	    DATA_PTR(self) = NULL;
	    if (RTEST(ossl_ssl_get_sync_close(self)))
		rb_funcall(io, rb_intern(&quot;close&quot;), 0);
	}
    }

    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="sysread-instance_method">
  
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>sysread</strong>(length) </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>sysread</strong>(length, buffer) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Reads <code>length</code> bytes from the SSL connection.  If a
pre-allocated <code>buffer</code> is provided the data will be written into
it.</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>) <strong>sysread</strong>(length) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../String.html" title="String (class)">String</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1305
1306
1307
1308
1309</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1305</span>

static VALUE
ossl_ssl_read(int argc, VALUE *argv, VALUE self)
{
    return ossl_ssl_read_internal(argc, argv, self, 0);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="syswrite-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>syswrite</strong>(string) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Writes <code>string</code> to the SSL connection.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1376
1377
1378
1379
1380</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1376</span>

static VALUE
ossl_ssl_write(VALUE self, VALUE str)
{
    return ossl_ssl_write_internal(self, str, 0);
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="verify_result-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>verify_result</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the result of the peer certificates verification.  See verify(1)
for error values and descriptions.</p>

<p>If no peer certificate was presented X509_V_OK is returned.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


1643
1644
1645
1646
1647
1648
1649
1650
1651
1652
1653
1654
1655</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 1643</span>

static VALUE
ossl_ssl_get_verify_result(VALUE self)
{
    SSL *ssl;

    Data_Get_Struct(self, SSL, ssl);
    if (!ssl) {
        rb_warning(&quot;SSL session is not started yet.&quot;);
        return Qnil;
    }

    return INT2FIX(SSL_get_verify_result(ssl));
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 19 10:17:13 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.9.3).
</div>

  </body>
</html>