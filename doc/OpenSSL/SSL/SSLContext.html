<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: OpenSSL::SSL::SSLContext
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="../../css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="../../css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '../../';
  framesUrl = "../../frames.html#!OpenSSL/SSL/SSLContext.html";
</script>


  <script type="text/javascript" charset="utf-8" src="../../js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="../../js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="../../_index.html">Index (S)</a> &raquo;
    <span class='title'><span class='object_link'><a href="../../OpenSSL.html" title="OpenSSL (module)">OpenSSL</a></span></span> &raquo; <span class='title'><span class='object_link'><a href="../SSL.html" title="OpenSSL::SSL (module)">SSL</a></span></span>
     &raquo; 
    <span class="title">SSLContext</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="../../class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="../../method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="../../file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: OpenSSL::SSL::SSLContext
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">OpenSSL::SSL::SSLContext</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/openssl/ossl_ssl.c<span class="defines">,<br />
  ext/openssl/ossl_ssl.c</span>
</dd>
  
</dl>
<div class="clear"></div>

<h2>Overview</h2><div class="docstring">
  <div class="discussion">
    
<p>An SSLContext is used to set various options regarding certificates,
algorithms, verification, session caching, etc.  The SSLContext is used to
create an SSLSocket.</p>

<p>All attributes must be set before creating an SSLSocket as the SSLContext
will be frozen afterward.</p>

<p>The following attributes are available but don’t show up in rdoc:</p>
<ul><li>
<p>ssl_version, cert, key, client_ca, ca_file, ca_path, timeout,</p>
</li><li>
<p>verify_mode, verify_depth client_cert_cb, tmp_dh_callback,</p>
</li><li>
<p>session_id_context, session_add_cb, session_new_cb, session_remove_cb</p>
</li></ul>


  </div>
</div>
<div class="tags">
  

</div>
  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="SESSION_CACHE_OFF-constant" class="">SESSION_CACHE_OFF =
          <div class="docstring">
  <div class="discussion">
    
<p>No session caching for client or server</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_OFF</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_CLIENT-constant" class="">SESSION_CACHE_CLIENT =
          <div class="docstring">
  <div class="discussion">
    
<p>doesn’t actually do anything in 0.9.8e</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_CLIENT</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_SERVER-constant" class="">SESSION_CACHE_SERVER =
          <div class="docstring">
  <div class="discussion">
    
<p>Server sessions are added to the session cache</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_SERVER</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_BOTH-constant" class="">SESSION_CACHE_BOTH =
          <div class="docstring">
  <div class="discussion">
    
<p>no different than CACHE_SERVER in 0.9.8e</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_BOTH</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_NO_AUTO_CLEAR-constant" class="">SESSION_CACHE_NO_AUTO_CLEAR =
          <div class="docstring">
  <div class="discussion">
    
<p>Normally the sesison cache is checked for expired sessions every 255
connections.  Since this may lead to a delay that cannot be controlled, the
automatic flushing may be disabled and #flush_sessions can be called
explicitly.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_NO_AUTO_CLEAR</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_NO_INTERNAL_LOOKUP-constant" class="">SESSION_CACHE_NO_INTERNAL_LOOKUP =
          <div class="docstring">
  <div class="discussion">
    
<p>Always perform external lookups of sessions even if they are in the
internal cache.</p>

<p>This flag has no effect on clients</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_NO_INTERNAL_LOOKUP</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_NO_INTERNAL_STORE-constant" class="">SESSION_CACHE_NO_INTERNAL_STORE =
          <div class="docstring">
  <div class="discussion">
    
<p>Never automatically store sessions in the internal store.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_NO_INTERNAL_STORE</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="SESSION_CACHE_NO_INTERNAL-constant" class="">SESSION_CACHE_NO_INTERNAL =
          <div class="docstring">
  <div class="discussion">
    
<p>Enables both SESSION_CACHE_NO_INTERNAL_LOOKUP and
SESSION_CACHE_NO_INTERNAL_STORE.</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='const'>LONG2FIX</span><span class='lparen'>(</span><span class='const'>SSL_SESS_CACHE_NO_INTERNAL</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="METHODS-constant" class="">METHODS =
          <div class="docstring">
  <div class="discussion">
    
<p>The list of available SSL/TLS methods</p>


  </div>
</div>
<div class="tags">
  

</div>
        </dt>
        <dd><pre class="code"><span class='id identifier rubyid_ary'>ary</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ciphers-instance_method" title="#ciphers (instance method)">- (Array) <strong>ciphers</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The list of ciphers configured for this context.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ciphers%3D-instance_method" title="#ciphers= (instance method)">- (Object) <strong>ciphers=</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>ctx.ciphers = [name, …]    ctx.ciphers = [[name, version, bits, alg_bits],
…].</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#flush_sessions-instance_method" title="#flush_sessions (instance method)">- (self) <strong>flush_sessions</strong>(time|nil) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes sessions in the internal cache that have expired at
<code>time</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#initialize (instance method)">- (Object) <strong>initialize</strong> </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>You can get a list of valid methods with OpenSSL::SSL::SSLContext::METHODS.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_add-instance_method" title="#session_add (instance method)">- (Object) <strong>session_add</strong>(session) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Adds <code>session</code> to the session cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_cache_mode-instance_method" title="#session_cache_mode (instance method)">- (Integer) <strong>session_cache_mode</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>The current session cache mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_cache_mode%3D-instance_method" title="#session_cache_mode= (instance method)">- (Integer) <strong>session_cache_mode=</strong>(integer) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the SSL session cache mode.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_cache_size-instance_method" title="#session_cache_size (instance method)">- (Integer) <strong>session_cache_size</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the current session cache size.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_cache_size%3D-instance_method" title="#session_cache_size= (instance method)">- (Integer) <strong>session_cache_size=</strong>(integer) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets the session cache size.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_cache_stats-instance_method" title="#session_cache_stats (instance method)">- (Hash) <strong>session_cache_stats</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns a Hash containing the following keys:.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#session_remove-instance_method" title="#session_remove (instance method)">- (Object) <strong>session_remove</strong>(session) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Removes <code>session</code> from the session cache.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#setup-instance_method" title="#setup (instance method)">- (Object) <strong>setup</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>This method is called automatically when a new SSLSocket is created.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#ssl_version%3D-instance_method" title="#ssl_version= (instance method)">- (Object) <strong>ssl_version=</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>ctx.ssl_version = “SSLv23_client”.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>new</strong> </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>new</strong>(:TLSv1) </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>new</strong>(&quot;SSLv23_client&quot;) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>You can get a list of valid methods with OpenSSL::SSL::SSLContext::METHODS</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 201</span>

static VALUE
ossl_sslctx_initialize(int argc, VALUE *argv, VALUE self)
{
    VALUE ssl_method;
    int i;

    for(i = 0; i &lt; numberof(ossl_sslctx_attrs); i++){
	char buf[32];
	snprintf(buf, sizeof(buf), &quot;@%s&quot;, ossl_sslctx_attrs[i]);
	rb_iv_set(self, buf, Qnil);
    }
    if (rb_scan_args(argc, argv, &quot;01&quot;, &amp;ssl_method) == 0){
        return self;
    }
    ossl_sslctx_set_ssl_version(self, ssl_method);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="ciphers-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>) <strong>ciphers</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The list of ciphers configured for this context.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


708
709
710
711
712
713
714
715
716
717
718
719
720
721
722
723
724
725
726
727
728
729
730
731
732
733
734</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 708</span>

static VALUE
ossl_sslctx_get_ciphers(VALUE self)
{
    SSL_CTX *ctx;
    STACK_OF(SSL_CIPHER) *ciphers;
    SSL_CIPHER *cipher;
    VALUE ary;
    int i, num;

    Data_Get_Struct(self, SSL_CTX, ctx);
    if(!ctx){
        rb_warning(&quot;SSL_CTX is not initialized.&quot;);
        return Qnil;
    }
    ciphers = ctx-&gt;cipher_list;

    if (!ciphers)
        return rb_ary_new();

    num = sk_SSL_CIPHER_num(ciphers);
    ary = rb_ary_new2(num);
    for(i = 0; i &lt; num; i++){
        cipher = sk_SSL_CIPHER_value(ciphers, i);
        rb_ary_push(ary, ossl_ssl_cipher_to_ary(cipher));
    }
    return ary;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ciphers=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ciphers=</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>ctx.ciphers = [name, …]</p>

<pre class="code"><code class="">ctx.ciphers = [[name, version, bits, alg_bits], ...]</code></pre>

<p>Sets the list of available ciphers for this context.  Note in a server
context some ciphers require the appropriate certificates.  For example, an
RSA cipher can only be chosen when an RSA certificate is available.</p>

<p>See also OpenSSL::Cipher and OpenSSL::Cipher::ciphers</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


748
749
750
751
752
753
754
755
756
757
758
759
760
761
762
763
764
765
766
767
768
769
770
771
772
773
774
775
776
777
778
779
780
781
782</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 748</span>

static VALUE
ossl_sslctx_set_ciphers(VALUE self, VALUE v)
{
    SSL_CTX *ctx;
    VALUE str, elem;
    int i;

    rb_check_frozen(self);
    if (NIL_P(v))
	return v;
    else if (TYPE(v) == T_ARRAY) {
        str = rb_str_new(0, 0);
        for (i = 0; i &lt; RARRAY_LEN(v); i++) {
            elem = rb_ary_entry(v, i);
            if (TYPE(elem) == T_ARRAY) elem = rb_ary_entry(elem, 0);
            elem = rb_String(elem);
            rb_str_append(str, elem);
            if (i &lt; RARRAY_LEN(v)-1) rb_str_cat2(str, &quot;:&quot;);
        }
    } else {
        str = v;
        StringValue(str);
    }

    Data_Get_Struct(self, SSL_CTX, ctx);
    if(!ctx){
        ossl_raise(eSSLError, &quot;SSL_CTX is not initialized.&quot;);
        return Qnil;
    }
    if (!SSL_CTX_set_cipher_list(ctx, RSTRING_PTR(str))) {
        ossl_raise(eSSLError, &quot;SSL_CTX_set_cipher_list:&quot;);
    }

    return v;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="flush_sessions-instance_method">
  
    - (<tt>self</tt>) <strong>flush_sessions</strong>(time|nil) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes sessions in the internal cache that have expired at
<code>time</code>.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>self</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


947
948
949
950
951
952
953
954
955
956
957
958
959
960
961
962
963
964
965
966
967
968
969</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 947</span>

static VALUE
ossl_sslctx_flush_sessions(int argc, VALUE *argv, VALUE self)
{
    VALUE arg1;
    SSL_CTX *ctx;
    time_t tm = 0;

    rb_scan_args(argc, argv, &quot;01&quot;, &amp;arg1);

    Data_Get_Struct(self, SSL_CTX, ctx);

    if (NIL_P(arg1)) {
        tm = time(0);
    } else if (rb_obj_is_instance_of(arg1, rb_cTime)) {
        tm = NUM2LONG(rb_funcall(arg1, rb_intern(&quot;to_i&quot;), 0));
    } else {
        ossl_raise(rb_eArgError, &quot;arg must be Time or nil&quot;);
    }

    SSL_CTX_flush_sessions(ctx, (long)tm);

    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_add-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>session_add</strong>(session) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Adds <code>session</code> to the session cache</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


791
792
793
794
795
796
797
798
799
800
801</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 791</span>

static VALUE
ossl_sslctx_session_add(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;
    SSL_SESSION *sess;

    Data_Get_Struct(self, SSL_CTX, ctx);
    SafeGetSSLSession(arg, sess);

    return SSL_CTX_add_session(ctx, sess) == 1 ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_cache_mode-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>session_cache_mode</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>The current session cache mode.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


827
828
829
830
831
832
833
834
835</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 827</span>

static VALUE
ossl_sslctx_get_session_cache_mode(VALUE self)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    return LONG2NUM(SSL_CTX_get_session_cache_mode(ctx));
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_cache_mode=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>session_cache_mode=</strong>(integer) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the SSL session cache mode.  Bitwise-or together the desired
SESSION_CACHE_* constants to set.  See SSL_CTX_set_session_cache_mode(3)
for details.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


845
846
847
848
849
850
851
852
853
854
855</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 845</span>

static VALUE
ossl_sslctx_set_session_cache_mode(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    SSL_CTX_set_session_cache_mode(ctx, NUM2LONG(arg));

    return arg;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_cache_size-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>session_cache_size</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the current session cache size.  Zero is used to represent an
unlimited cache size.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


864
865
866
867
868
869
870
871
872</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 864</span>

static VALUE
ossl_sslctx_get_session_cache_size(VALUE self)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    return LONG2NUM(SSL_CTX_sess_get_cache_size(ctx));
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_cache_size=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>) <strong>session_cache_size=</strong>(integer) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets the session cache size.  Returns the previously valid session cache
size.  Zero is used to represent an unlimited session cache size.</p>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Integer.html" title="Integer (class)">Integer</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


881
882
883
884
885
886
887
888
889
890
891</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 881</span>

static VALUE
ossl_sslctx_set_session_cache_size(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;

    Data_Get_Struct(self, SSL_CTX, ctx);

    SSL_CTX_sess_set_cache_size(ctx, NUM2LONG(arg));

    return arg;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_cache_stats-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>) <strong>session_cache_stats</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns a Hash containing the following keys:</p>
<dl class="rdoc-list note-list"><dt>:accept
<dd>
<p>Number of started SSL/TLS handshakes in server mode</p>
</dd><dt>:accept_good
<dd>
<p>Number of established SSL/TLS sessions in server mode</p>
</dd><dt>:accept_renegotiate
<dd>
<p>Number of start renegotiations in server mode</p>
</dd><dt>:cache_full
<dd>
<p>Number of sessions that were removed due to cache overflow</p>
</dd><dt>:cache_hits
<dd>
<p>Number of successfully reused connections</p>
</dd><dt>:cache_misses
<dd>
<p>Number of sessions proposed by clients that were not found</p>
</dd></dl>

<pre class="code"><code class="">in the cache</code></pre>
<dl class="rdoc-list note-list"><dt>:cache_num
<dd>
<p>Number of sessions in the internal session cache</p>
</dd><dt>:cb_hits
<dd>
<p>Number of sessions retrieved from the external cache in server</p>
</dd></dl>

<pre class="code"><code class=""><span class='id identifier rubyid_mode'>mode</span></code></pre>
<dl class="rdoc-list note-list"><dt>:connect
<dd>
<p>Number of started SSL/TLS handshakes in client mode</p>
</dd><dt>:connect_good
<dd>
<p>Number of established SSL/TLS sessions in client mode</p>
</dd><dt>:connect_renegotiate
<dd>
<p>Number of start renegotiations in client mode</p>
</dd><dt>:timeouts
<dd>
<p>Number of sessions proposed by clients that were found in the</p>
</dd></dl>

<pre class="code"><code class=""><span class='id identifier rubyid_cache'>cache</span> <span class='id identifier rubyid_but'>but</span> <span class='id identifier rubyid_had'>had</span> <span class='id identifier rubyid_expired'>expired</span> <span class='id identifier rubyid_due'>due</span> <span class='id identifier rubyid_to'>to</span> <span class='id identifier rubyid_timeouts'>timeouts</span></code></pre>


  </div>
</div>
<div class="tags">
  
  <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="../../Hash.html" title="Hash (class)">Hash</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


915
916
917
918
919
920
921
922
923
924
925
926
927
928
929
930
931
932
933
934
935
936
937
938</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 915</span>

static VALUE
ossl_sslctx_get_session_cache_stats(VALUE self)
{
    SSL_CTX *ctx;
    VALUE hash;

    Data_Get_Struct(self, SSL_CTX, ctx);

    hash = rb_hash_new();
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_num&quot;)), LONG2NUM(SSL_CTX_sess_number(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect&quot;)), LONG2NUM(SSL_CTX_sess_connect(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect_good&quot;)), LONG2NUM(SSL_CTX_sess_connect_good(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;connect_renegotiate&quot;)), LONG2NUM(SSL_CTX_sess_connect_renegotiate(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept&quot;)), LONG2NUM(SSL_CTX_sess_accept(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept_good&quot;)), LONG2NUM(SSL_CTX_sess_accept_good(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;accept_renegotiate&quot;)), LONG2NUM(SSL_CTX_sess_accept_renegotiate(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_hits&quot;)), LONG2NUM(SSL_CTX_sess_hits(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cb_hits&quot;)), LONG2NUM(SSL_CTX_sess_cb_hits(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_misses&quot;)), LONG2NUM(SSL_CTX_sess_misses(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;cache_full&quot;)), LONG2NUM(SSL_CTX_sess_cache_full(ctx)));
    rb_hash_aset(hash, ID2SYM(rb_intern(&quot;timeouts&quot;)), LONG2NUM(SSL_CTX_sess_timeouts(ctx)));

    return hash;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="session_remove-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>session_remove</strong>(session) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Removes <code>session</code> from the session cache</p>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


809
810
811
812
813
814
815
816
817
818
819</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 809</span>

static VALUE
ossl_sslctx_session_remove(VALUE self, VALUE arg)
{
    SSL_CTX *ctx;
    SSL_SESSION *sess;

    Data_Get_Struct(self, SSL_CTX, ctx);
    SafeGetSSLSession(arg, sess);

    return SSL_CTX_remove_session(ctx, sess) == 1 ? Qtrue : Qfalse;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="setup-instance_method">
  
    
      <span class="overload">- (<tt>Qtrue #firstt time</tt>) <strong>setup</strong> </span>
    
      <span class="overload">- (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>setup</strong> </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>This method is called automatically when a new SSLSocket is created.
Normally you do not need to call this method (unless you are writing an
extension in C).</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">- (<tt>Qtrue #firstt time</tt>) <strong>setup</strong> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Qtrue #firstt time</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606
607
608
609
610
611
612
613
614
615
616
617
618
619
620
621
622
623
624
625
626
627
628
629
630
631
632
633
634
635
636
637
638
639
640
641
642
643
644
645
646
647
648
649
650
651
652
653
654
655
656
657
658
659
660
661
662
663
664
665
666
667
668
669
670
671
672
673
674
675
676
677
678
679
680
681
682
683
684</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 542</span>

static VALUE
ossl_sslctx_setup(VALUE self)
{
    SSL_CTX *ctx;
    X509 *cert = NULL, *client_ca = NULL;
    X509_STORE *store;
    EVP_PKEY *key = NULL;
    char *ca_path = NULL, *ca_file = NULL;
    int i, verify_mode;
    VALUE val;

    if(OBJ_FROZEN(self)) return Qnil;
    Data_Get_Struct(self, SSL_CTX, ctx);

#if !defined(OPENSSL_NO_DH)
    if (RTEST(ossl_sslctx_get_tmp_dh_cb(self))){
	SSL_CTX_set_tmp_dh_callback(ctx, ossl_tmp_dh_callback);
    }
    else{
	SSL_CTX_set_tmp_dh_callback(ctx, ossl_default_tmp_dh_callback);
    }
#endif
    SSL_CTX_set_ex_data(ctx, ossl_ssl_ex_ptr_idx, (void*)self);

    val = ossl_sslctx_get_cert_store(self);
    if(!NIL_P(val)){
	/*
         * WORKAROUND:
	 *   X509_STORE can count references, but
	 *   X509_STORE_free() doesn't care it.
	 *   So we won't increment it but mark it by ex_data.
	 */
        store = GetX509StorePtr(val); /* NO NEED TO DUP */
        SSL_CTX_set_cert_store(ctx, store);
        SSL_CTX_set_ex_data(ctx, ossl_ssl_ex_store_p, (void*)1);
    }

    val = ossl_sslctx_get_extra_cert(self);
    if(!NIL_P(val)){
	rb_block_call(val, rb_intern(&quot;each&quot;), 0, 0, ossl_sslctx_add_extra_chain_cert_i, self);
    }

    /* private key may be bundled in certificate file. */
    val = ossl_sslctx_get_cert(self);
    cert = NIL_P(val) ? NULL : GetX509CertPtr(val); /* NO DUP NEEDED */
    val = ossl_sslctx_get_key(self);
    key = NIL_P(val) ? NULL : GetPKeyPtr(val); /* NO DUP NEEDED */
    if (cert &amp;&amp; key) {
        if (!SSL_CTX_use_certificate(ctx, cert)) {
            /* Adds a ref =&gt; Safe to FREE */
            ossl_raise(eSSLError, &quot;SSL_CTX_use_certificate:&quot;);
        }
        if (!SSL_CTX_use_PrivateKey(ctx, key)) {
            /* Adds a ref =&gt; Safe to FREE */
            ossl_raise(eSSLError, &quot;SSL_CTX_use_PrivateKey:&quot;);
        }
        if (!SSL_CTX_check_private_key(ctx)) {
            ossl_raise(eSSLError, &quot;SSL_CTX_check_private_key:&quot;);
        }
    }

    val = ossl_sslctx_get_client_ca(self);
    if(!NIL_P(val)){
	if(TYPE(val) == T_ARRAY){
	    for(i = 0; i &lt; RARRAY_LEN(val); i++){
		client_ca = GetX509CertPtr(RARRAY_PTR(val)[i]);
        	if (!SSL_CTX_add_client_CA(ctx, client_ca)){
		    /* Copies X509_NAME =&gt; FREE it. */
        	    ossl_raise(eSSLError, &quot;SSL_CTX_add_client_CA&quot;);
        	}
	    }
        }
	else{
	    client_ca = GetX509CertPtr(val); /* NO DUP NEEDED. */
            if (!SSL_CTX_add_client_CA(ctx, client_ca)){
		/* Copies X509_NAME =&gt; FREE it. */
        	ossl_raise(eSSLError, &quot;SSL_CTX_add_client_CA&quot;);
            }
	}
    }

    val = ossl_sslctx_get_ca_file(self);
    ca_file = NIL_P(val) ? NULL : StringValuePtr(val);
    val = ossl_sslctx_get_ca_path(self);
    ca_path = NIL_P(val) ? NULL : StringValuePtr(val);
    if(ca_file || ca_path){
	if (!SSL_CTX_load_verify_locations(ctx, ca_file, ca_path))
	    rb_warning(&quot;can't set verify locations&quot;);
    }

    val = ossl_sslctx_get_verify_mode(self);
    verify_mode = NIL_P(val) ? SSL_VERIFY_NONE : NUM2INT(val);
    SSL_CTX_set_verify(ctx, verify_mode, ossl_ssl_verify_callback);
    if (RTEST(ossl_sslctx_get_client_cert_cb(self)))
	SSL_CTX_set_client_cert_cb(ctx, ossl_client_cert_cb);

    val = ossl_sslctx_get_timeout(self);
    if(!NIL_P(val)) SSL_CTX_set_timeout(ctx, NUM2LONG(val));

    val = ossl_sslctx_get_verify_dep(self);
    if(!NIL_P(val)) SSL_CTX_set_verify_depth(ctx, NUM2INT(val));

    val = ossl_sslctx_get_options(self);
    if(!NIL_P(val)) {
	SSL_CTX_set_options(ctx, NUM2LONG(val));
    }
    else {
	SSL_CTX_set_options(ctx, SSL_OP_ALL);
    }
    rb_obj_freeze(self);

    val = ossl_sslctx_get_sess_id_ctx(self);
    if (!NIL_P(val)){
	StringValue(val);
	if (!SSL_CTX_set_session_id_context(ctx, (unsigned char *)RSTRING_PTR(val),
					    RSTRING_LENINT(val))){
	    ossl_raise(eSSLError, &quot;SSL_CTX_set_session_id_context:&quot;);
	}
    }

    if (RTEST(rb_iv_get(self, &quot;@session_get_cb&quot;))) {
	SSL_CTX_sess_set_get_cb(ctx, ossl_sslctx_session_get_cb);
	OSSL_Debug(&quot;SSL SESSION get callback added&quot;);
    }
    if (RTEST(rb_iv_get(self, &quot;@session_new_cb&quot;))) {
	SSL_CTX_sess_set_new_cb(ctx, ossl_sslctx_session_new_cb);
	OSSL_Debug(&quot;SSL SESSION new callback added&quot;);
    }
    if (RTEST(rb_iv_get(self, &quot;@session_remove_cb&quot;))) {
	SSL_CTX_sess_set_remove_cb(ctx, ossl_sslctx_session_remove_cb);
	OSSL_Debug(&quot;SSL SESSION remove callback added&quot;);
    }

#ifdef HAVE_SSL_SET_TLSEXT_HOST_NAME
    val = rb_iv_get(self, &quot;@servername_cb&quot;);
    if (!NIL_P(val)) {
        SSL_CTX_set_tlsext_servername_callback(ctx, ssl_servername_cb);
	OSSL_Debug(&quot;SSL TLSEXT servername callback added&quot;);
    }
#endif

    return Qtrue;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="ssl_version=-instance_method">
  
    - (<tt><span class='object_link'><a href="../../Object.html" title="Object (class)">Object</a></span></tt>) <strong>ssl_version=</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>ctx.ssl_version = “SSLv23_client”</p>

<p>You can get a list of valid versions with OpenSSL::SSL::SSLContext::METHODS</p>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/openssl/ossl_ssl.c', line 164</span>

static VALUE
ossl_sslctx_set_ssl_version(VALUE self, VALUE ssl_method)
{
    SSL_METHOD *method = NULL;
    const char *s;
    int i;

    SSL_CTX *ctx;
    if(TYPE(ssl_method) == T_SYMBOL)
	s = rb_id2name(SYM2ID(ssl_method));
    else
	s =  StringValuePtr(ssl_method);
    for (i = 0; i &lt; numberof(ossl_ssl_method_tab); i++) {
        if (strcmp(ossl_ssl_method_tab[i].name, s) == 0) {
            method = ossl_ssl_method_tab[i].func();
            break;
        }
    }
    if (!method) {
        ossl_raise(rb_eArgError, &quot;unknown SSL method `%s'.&quot;, s);
    }
    Data_Get_Struct(self, SSL_CTX, ctx);
    if (SSL_CTX_set_ssl_version(ctx, method) != 1) {
        ossl_raise(eSSLError, &quot;SSL_CTX_set_ssl_version:&quot;);
    }

    return ssl_method;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 19 10:17:13 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.9.3).
</div>

  </body>
</html>