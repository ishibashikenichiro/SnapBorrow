<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Module: PTY
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!PTY.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (P)</a> &raquo;
    
    
    <span class="title">PTY</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Module: PTY
  
  
  
</h1>

<dl class="box">
  
  
    
  
    
  
  
  
    <dt class="r1 last">Defined in:</dt>
    <dd class="r1 last">ext/pty/pty.c</dd>
  
</dl>
<div class="clear"></div>

<h2>Defined Under Namespace</h2>
<p class="children">
  
    
  
    
      <strong class="classes">Classes:</strong> <span class='object_link'><a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">ChildExited</a></span>
    
  
</p>







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#check-class_method" title="check (class method)">+ (Object) <strong>check</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Checks the status of the child process specified by <code>pid</code>.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#getpty-class_method" title="getpty (class method)">+ (Object) <strong>getpty</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Spawns the specified command on a newly allocated pty.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#open-class_method" title="open (class method)">+ (Object) <strong>open</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Allocates a pty (pseudo-terminal).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#spawn-class_method" title="spawn (class method)">+ (Object) <strong>spawn</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Spawns the specified command on a newly allocated pty.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="check-class_method">
  
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Process/Status.html" title="Process::Status (class)">Process::Status</a></span></tt><sup>?</sup>) <strong>check</strong>(pid, raise = false) </span>
    
      <span class="overload">+ (<tt>nil</tt>, <tt>raises <span class='object_link'><a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">PTY::ChildExited</a></span></tt>) <strong>check</strong>(pid, true) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Checks the status of the child process specified by <code>pid</code>.
Returns <code>nil</code> if the process is still alive.  If the process is
not alive, will return a <code>Process::Status</code> or raise a
<code>PTY::ChildExited</code> (if <code>raise</code> was true).</p>
<dl class="rdoc-list note-list"><dt><code>pid</code>
<dd>
<p>The process id of the process to check</p>
</dd><dt><code>raise</code>
<dd>
<p>If true and the process identified by <code>pid</code> is no longer alive a
<code>PTY::ChildExited</code> is raised.</p>
</dd></dl>

<p>Returns nil or a <code>Process::Status</code> when <code>raise</code> is
false.</p>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Process/Status.html" title="Process::Status (class)">Process::Status</a></span></tt><sup>?</sup>) <strong>check</strong>(pid, raise = false) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Process/Status.html" title="Process::Status (class)">Process::Status</a></span></tt>, <tt>nil</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt>nil</tt>, <tt>raises <span class='object_link'><a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">PTY::ChildExited</a></span></tt>) <strong>check</strong>(pid, true) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>nil</tt>, <tt>raises <span class='object_link'><a href="PTY/ChildExited.html" title="PTY::ChildExited (class)">PTY::ChildExited</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


652
653
654
655
656
657
658
659
660
661
662
663
664
665
666</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/pty/pty.c', line 652</span>

static VALUE
pty_check(int argc, VALUE *argv, VALUE self)
{
    VALUE pid, exc;
    pid_t cpid;
    int status;

    rb_scan_args(argc, argv, &quot;11&quot;, &amp;pid, &amp;exc);
    cpid = rb_waitpid(NUM2PIDT(pid), &amp;status, WNOHANG|WUNTRACED);
    if (cpid == -1 || cpid == 0) return Qnil;

    if (!RTEST(exc)) return rb_last_status_get();
    raise_from_check(cpid, status);
    return Qnil;		/* not reached */
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="getpty-class_method">
  
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command_line) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command_line) </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command, args, ...) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command, args, ...) </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command_line) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command_line) </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command, args, ...) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command, args, ...) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Spawns the specified command on a newly allocated pty.</p>

<p>The command’s controlling tty is set to the slave device of the pty and its
standard input/output/error is redirected to the slave device.</p>
<dl class="rdoc-list note-list"><dt><code>command_line</code>
<dd>
<p>The full command line to run</p>
</dd><dt><code>command</code>
<dd>
<p>The command to run, as a String.</p>
</dd><dt><code>args</code>
<dd>
<p>Zero or more arguments, as Strings, representing the arguments to
<code>command</code></p>
</dd></dl>

<p>In the non-block form this returns an array of size three, <code>[r, w,
pid]</code>.  In the block form the block will be called with these as
arguments, <code>|r,w,pid|</code>:</p>
<dl class="rdoc-list note-list"><dt><code>r</code>
<dd>
<p>An IO that can be read from that contains the command’s standard output and
standard error</p>
</dd><dt><code>w</code>
<dd>
<p>An IO that can be written to that is the command’s standard input</p>
</dd><dt><code>pid</code>
<dd>
<p>The process identifier for the command.</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command_line) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command_line) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command, args, ...) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command, args, ...) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command_line) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command_line) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command, args, ...) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command, args, ...) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/pty/pty.c', line 570</span>

static VALUE
pty_getpty(int argc, VALUE *argv, VALUE self)
{
    VALUE res;
    struct pty_info info;
    rb_io_t *wfptr,*rfptr;
    VALUE rport = rb_obj_alloc(rb_cFile);
    VALUE wport = rb_obj_alloc(rb_cFile);
    char SlaveName[DEVICELEN];

    MakeOpenFile(rport, rfptr);
    MakeOpenFile(wport, wfptr);

    establishShell(argc, argv, &amp;info, SlaveName);

    rfptr-&gt;mode = rb_io_mode_flags(&quot;r&quot;);
    rfptr-&gt;fd = info.fd;
    rfptr-&gt;pathv = rb_obj_freeze(rb_str_new_cstr(SlaveName));

    wfptr-&gt;mode = rb_io_mode_flags(&quot;w&quot;) | FMODE_SYNC;
    wfptr-&gt;fd = dup(info.fd);
    if (wfptr-&gt;fd == -1)
        rb_sys_fail(&quot;dup()&quot;);
    rb_update_max_fd(wfptr-&gt;fd);
    wfptr-&gt;pathv = rfptr-&gt;pathv;

    res = rb_ary_new2(3);
    rb_ary_store(res,0,(VALUE)rport);
    rb_ary_store(res,1,(VALUE)wport);
    rb_ary_store(res,2,PIDT2NUM(info.child_pid));

    if (rb_block_given_p()) {
	rb_ensure(rb_yield, res, pty_detach_process, (VALUE)&amp;info);
	return Qnil;
    }
    return res;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="open-class_method">
  
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>open</strong> </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>open</strong> {|master_io, slave_file| ... }</span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Allocates a pty (pseudo-terminal).</p>

<p>In the non-block form, returns a two element array, <code>[master_io,
slave_file]</code>.</p>

<p>In the block form, yields two arguments <code>master_io, slave_file</code>
and the value of the block is returned from <code>open</code>.</p>

<p>The IO and File are both closed after the block completes if they haven’t
been already closed.</p>

<p>The arguments in both forms are:</p>
<dl class="rdoc-list note-list"><dt><code>master_io</code>
<dd>
<p>the master of the pty, as an IO.</p>
</dd><dt><code>slave_file</code>
<dd>
<p>the slave of the pty, as a File.  The path to the terminal device is
available via <code>slave_file.path</code></p>
</dd></dl>

<h3 id="label-Example">Example</h3>

<pre class="ruby"><span class="ruby-constant">PTY</span>.<span class="ruby-identifier">open</span> {<span class="ruby-operator">|</span><span class="ruby-identifier">m</span>, <span class="ruby-identifier">s</span><span class="ruby-operator">|</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">m</span>      <span class="ruby-comment">#=&gt; #&lt;IO:masterpty:/dev/pts/1&gt;</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">s</span>      <span class="ruby-comment">#=&gt; #&lt;File:/dev/pts/1&gt;</span>
  <span class="ruby-identifier">p</span> <span class="ruby-identifier">s</span>.<span class="ruby-identifier">path</span> <span class="ruby-comment">#=&gt; &quot;/dev/pts/1&quot;</span>
}

<span class="ruby-comment"># Change the buffering type in factor command,</span>
<span class="ruby-comment"># assuming that factor uses stdio for stdout buffering.</span>
<span class="ruby-comment"># If IO.pipe is used instead of PTY.open,</span>
<span class="ruby-comment"># this code deadlocks because factor's stdout is fully buffered.</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">'io/console'</span> <span class="ruby-comment"># for IO#raw!</span>
<span class="ruby-identifier">m</span>, <span class="ruby-identifier">s</span> = <span class="ruby-constant">PTY</span>.<span class="ruby-identifier">open</span>
<span class="ruby-identifier">s</span>.<span class="ruby-identifier">raw!</span> <span class="ruby-comment"># disable newline conversion.</span>
<span class="ruby-identifier">r</span>, <span class="ruby-identifier">w</span> = <span class="ruby-constant">IO</span>.<span class="ruby-identifier">pipe</span>
<span class="ruby-identifier">pid</span> = <span class="ruby-identifier">spawn</span>(<span class="ruby-string">&quot;factor&quot;</span>, :<span class="ruby-keyword">in</span>=<span class="ruby-operator">&gt;</span><span class="ruby-identifier">r</span>, :<span class="ruby-identifier">out=</span><span class="ruby-operator">&gt;</span><span class="ruby-identifier">s</span>)
<span class="ruby-identifier">r</span>.<span class="ruby-identifier">close</span>
<span class="ruby-identifier">s</span>.<span class="ruby-identifier">close</span>
<span class="ruby-identifier">w</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;42&quot;</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment">#=&gt; &quot;42: 2 3 7\n&quot;</span>
<span class="ruby-identifier">w</span>.<span class="ruby-identifier">puts</span> <span class="ruby-string">&quot;144&quot;</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">m</span>.<span class="ruby-identifier">gets</span> <span class="ruby-comment">#=&gt; &quot;144: 2 2 2 2 3 3\n&quot;</span>
<span class="ruby-identifier">w</span>.<span class="ruby-identifier">close</span>
<span class="ruby-comment"># The result of read operation when pty slave is closed is platform</span>
<span class="ruby-comment"># dependent.</span>
<span class="ruby-identifier">ret</span> = <span class="ruby-keyword">begin</span>
        <span class="ruby-identifier">m</span>.<span class="ruby-identifier">gets</span>          <span class="ruby-comment"># FreeBSD returns nil.</span>
      <span class="ruby-keyword">rescue</span> <span class="ruby-constant">Errno</span><span class="ruby-operator">::</span><span class="ruby-constant">EIO</span> <span class="ruby-comment"># GNU/Linux raises EIO.</span>
        <span class="ruby-keyword">nil</span>
      <span class="ruby-keyword">end</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">ret</span> <span class="ruby-comment">#=&gt; nil</span>
</pre>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>open</strong> </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>open</strong> {|master_io, slave_file| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>master_io</tt>, <tt>slave_file</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/pty/pty.c', line 502</span>

static VALUE
pty_open(VALUE klass)
{
    int master_fd, slave_fd;
    char slavename[DEVICELEN];
    VALUE master_io, slave_file;
    rb_io_t *master_fptr, *slave_fptr;
    VALUE assoc;

    getDevice(&amp;master_fd, &amp;slave_fd, slavename, 1);

    master_io = rb_obj_alloc(rb_cIO);
    MakeOpenFile(master_io, master_fptr);
    master_fptr-&gt;mode = FMODE_READWRITE | FMODE_SYNC | FMODE_DUPLEX;
    master_fptr-&gt;fd = master_fd;
    master_fptr-&gt;pathv = rb_obj_freeze(rb_sprintf(&quot;masterpty:%s&quot;, slavename));

    slave_file = rb_obj_alloc(rb_cFile);
    MakeOpenFile(slave_file, slave_fptr);
    slave_fptr-&gt;mode = FMODE_READWRITE | FMODE_SYNC | FMODE_DUPLEX | FMODE_TTY;
    slave_fptr-&gt;fd = slave_fd;
    slave_fptr-&gt;pathv = rb_obj_freeze(rb_str_new_cstr(slavename));

    assoc = rb_assoc_new(master_io, slave_file);
    if (rb_block_given_p()) {
	return rb_ensure(rb_yield, assoc, pty_close_pty, assoc);
    }
    return assoc;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="spawn-class_method">
  
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command_line) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command_line) </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command, args, ...) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command, args, ...) </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command_line) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command_line) </span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command, args, ...) {|r, w, pid| ... }</span>
    
      <span class="overload">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command, args, ...) </span>
    
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Spawns the specified command on a newly allocated pty.</p>

<p>The command’s controlling tty is set to the slave device of the pty and its
standard input/output/error is redirected to the slave device.</p>
<dl class="rdoc-list note-list"><dt><code>command_line</code>
<dd>
<p>The full command line to run</p>
</dd><dt><code>command</code>
<dd>
<p>The command to run, as a String.</p>
</dd><dt><code>args</code>
<dd>
<p>Zero or more arguments, as Strings, representing the arguments to
<code>command</code></p>
</dd></dl>

<p>In the non-block form this returns an array of size three, <code>[r, w,
pid]</code>.  In the block form the block will be called with these as
arguments, <code>|r,w,pid|</code>:</p>
<dl class="rdoc-list note-list"><dt><code>r</code>
<dd>
<p>An IO that can be read from that contains the command’s standard output and
standard error</p>
</dd><dt><code>w</code>
<dd>
<p>An IO that can be written to that is the command’s standard input</p>
</dd><dt><code>pid</code>
<dd>
<p>The process identifier for the command.</p>
</dd></dl>


  </div>
</div>
<div class="tags">
  
  <p class="tag_title">Overloads:</p>
  <ul class="overload">
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command_line) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command_line) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>spawn</strong>(command, args, ...) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>spawn</strong>(command, args, ...) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command_line) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command_line) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>getpty</strong>(command, args, ...) {|r, w, pid| ... }</span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Yields:</p>
<ul class="yield">
  
    <li>
      
      
        <span class='type'>(<tt>r</tt>, <tt>w</tt>, <tt>pid</tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
      
      <li class="overload_item">
        <span class="signature">+ (<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>) <strong>getpty</strong>(command, args, ...) </span>
        <div class="docstring">
  <div class="discussion">
    

  </div>
</div>
<div class="tags">
  
<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt><span class='object_link'><a href="Array.html" title="Array (class)">Array</a></span></tt>)</span>
      
      
      
    </li>
  
</ul>

</div>
      </li>
    
  </ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
604
605
606</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/pty/pty.c', line 570</span>

static VALUE
pty_getpty(int argc, VALUE *argv, VALUE self)
{
    VALUE res;
    struct pty_info info;
    rb_io_t *wfptr,*rfptr;
    VALUE rport = rb_obj_alloc(rb_cFile);
    VALUE wport = rb_obj_alloc(rb_cFile);
    char SlaveName[DEVICELEN];

    MakeOpenFile(rport, rfptr);
    MakeOpenFile(wport, wfptr);

    establishShell(argc, argv, &amp;info, SlaveName);

    rfptr-&gt;mode = rb_io_mode_flags(&quot;r&quot;);
    rfptr-&gt;fd = info.fd;
    rfptr-&gt;pathv = rb_obj_freeze(rb_str_new_cstr(SlaveName));

    wfptr-&gt;mode = rb_io_mode_flags(&quot;w&quot;) | FMODE_SYNC;
    wfptr-&gt;fd = dup(info.fd);
    if (wfptr-&gt;fd == -1)
        rb_sys_fail(&quot;dup()&quot;);
    rb_update_max_fd(wfptr-&gt;fd);
    wfptr-&gt;pathv = rfptr-&gt;pathv;

    res = rb_ary_new2(3);
    rb_ary_store(res,0,(VALUE)rport);
    rb_ary_store(res,1,(VALUE)wport);
    rb_ary_store(res,2,PIDT2NUM(info.child_pid));

    if (rb_block_given_p()) {
	rb_ensure(rb_yield, res, pty_detach_process, (VALUE)&amp;info);
	return Qnil;
    }
    return res;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 19 10:16:19 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.9.3).
</div>

  </body>
</html>