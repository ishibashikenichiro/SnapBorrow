<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>
  Class: WIN32OLE_VARIANT
  
    &mdash; Documentation by YARD 0.8.7.4
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" charset="utf-8" />

  <link rel="stylesheet" href="css/common.css" type="text/css" charset="utf-8" />

<script type="text/javascript" charset="utf-8">
  hasFrames = window.top.frames.main ? true : false;
  relpath = '';
  framesUrl = "frames.html#!WIN32OLE_VARIANT.html";
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div id="header">
      <div id="menu">
  
    <a href="_index.html">Index (W)</a> &raquo;
    
    
    <span class="title">WIN32OLE_VARIANT</span>
  

  <div class="noframes"><span class="title">(</span><a href="." target="_top">no frames</a><span class="title">)</span></div>
</div>

      <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">
      Class List
    </a>
  
    <a class="full_list_link" id="method_list_link"
        href="method_list.html">
      Method List
    </a>
  
    <a class="full_list_link" id="file_list_link"
        href="file_list.html">
      File List
    </a>
  
</div>
      <div class="clear"></div>
    </div>

    <iframe id="search_frame"></iframe>

    <div id="content"><h1>Class: WIN32OLE_VARIANT
  
  
  
</h1>

<dl class="box">
  
    <dt class="r1">Inherits:</dt>
    <dd class="r1">
      <span class="inheritName"><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></span>
      
        <ul class="fullTree">
          <li><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></li>
          
            <li class="next">WIN32OLE_VARIANT</li>
          
        </ul>
        <a href="#" class="inheritanceTree">show all</a>
      
      </dd>
    
  
  
    
  
    
  
  
  
    <dt class="r2 last">Defined in:</dt>
    <dd class="r2 last">ext/win32ole/win32ole.c</dd>
  
</dl>
<div class="clear"></div>


  <h2>Constant Summary</h2>
  
    <dl class="constants">
      
        <dt id="Empty-constant" class="">Empty =
          
        </dt>
        <dd><pre class="code"><span class='id identifier rubyid_rb_funcall'>rb_funcall</span><span class='lparen'>(</span><span class='id identifier rubyid_cWIN32OLE_VARIANT'>cWIN32OLE_VARIANT</span><span class='comma'>,</span> <span class='id identifier rubyid_rb_intern'>rb_intern</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='const'>Qnil</span><span class='comma'>,</span> <span class='const'>INT2FIX</span><span class='lparen'>(</span><span class='const'>VT_EMPTY</span><span class='rparen'>)</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="Null-constant" class="">Null =
          
        </dt>
        <dd><pre class="code"><span class='id identifier rubyid_rb_funcall'>rb_funcall</span><span class='lparen'>(</span><span class='id identifier rubyid_cWIN32OLE_VARIANT'>cWIN32OLE_VARIANT</span><span class='comma'>,</span> <span class='id identifier rubyid_rb_intern'>rb_intern</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='const'>Qnil</span><span class='comma'>,</span> <span class='const'>INT2FIX</span><span class='lparen'>(</span><span class='const'>VT_NULL</span><span class='rparen'>)</span><span class='rparen'>)</span></pre></dd>
      
        <dt id="Nothing-constant" class="">Nothing =
          
        </dt>
        <dd><pre class="code"><span class='id identifier rubyid_rb_funcall'>rb_funcall</span><span class='lparen'>(</span><span class='id identifier rubyid_cWIN32OLE_VARIANT'>cWIN32OLE_VARIANT</span><span class='comma'>,</span> <span class='id identifier rubyid_rb_intern'>rb_intern</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>new</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='comma'>,</span> <span class='int'>2</span><span class='comma'>,</span> <span class='const'>Qnil</span><span class='comma'>,</span> <span class='const'>INT2FIX</span><span class='lparen'>(</span><span class='const'>VT_DISPATCH</span><span class='rparen'>)</span><span class='rparen'>)</span></pre></dd>
      
    </dl>
  







  
    <h2>
      Class Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#array-class_method" title="array (class method)">+ (Object) <strong>array</strong>(ary, vt) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns Ruby object wrapping OLE variant whose variant type is VT_ARRAY.</p>
</div></span>
  
</li>

      
    </ul>
  
    <h2>
      Instance Method Summary
      <small>(<a href="#" class="summary_toggle">collapse</a>)</small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D-instance_method" title="#[] (instance method)">- (Object) <strong>[]</strong>(i, j, ...) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns the element of WIN32OLE_VARIANT object(OLE array).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#%5B%5D%3D-instance_method" title="#[]= (instance method)">- (Object) <strong>[]=</strong>(i, j, ...) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Set the element of WIN32OLE_VARIANT object(OLE array) to val.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#initialize-instance_method" title="#new (instance method)">- (Object) <strong>new</strong>(val, vartype) </a>
    

    
  </span>
  
  
    <span class="note title constructor">constructor</span>
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns Ruby object wrapping OLE variant.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value-instance_method" title="#value (instance method)">- (Object) <strong>value</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns Ruby object value from OLE variant.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#value%3D-instance_method" title="#value= (instance method)">- (Object) <strong>value=</strong>(val) </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Sets variant value to val.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="#vartype-instance_method" title="#vartype (instance method)">- (Object) <strong>vartype</strong> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Returns OLE variant type.</p>
</div></span>
  
</li>

      
    </ul>
  

<div id="constructor_details" class="method_details_list">
  <h2>Constructor Details</h2>
  
    <div class="method_details first">
  <h3 class="signature first" id="initialize-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>new</strong>(val, vartype) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Ruby object wrapping OLE variant. The first argument specifies Ruby
object to convert OLE variant variable. The second argument specifies
VARIANT type. In some situation, you need the WIN32OLE_VARIANT object to
pass OLE method</p>

<pre class="code"><code class=""><span class='id identifier rubyid_shell'>shell</span> <span class='op'>=</span> <span class='const'>WIN32OLE</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Shell.Application</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_folder'>folder</span> <span class='op'>=</span> <span class='id identifier rubyid_shell'>shell</span><span class='period'>.</span><span class='const'>NameSpace</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>C:\\Windows</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_item'>item</span> <span class='op'>=</span> <span class='id identifier rubyid_folder'>folder</span><span class='period'>.</span><span class='const'>ParseName</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tmp.txt</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='comment'># You can't use Ruby String object to call FolderItem.InvokeVerb.
</span><span class='comment'># Instead, you have to use WIN32OLE_VARIANT object to call the method.
</span><span class='id identifier rubyid_shortcut'>shortcut</span> <span class='op'>=</span> <span class='const'>WIN32OLE_VARIANT</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Create Shortcut(\&amp;S)</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='id identifier rubyid_item'>item</span><span class='period'>.</span><span class='id identifier rubyid_invokeVerb'>invokeVerb</span><span class='lparen'>(</span><span class='id identifier rubyid_shortcut'>shortcut</span><span class='rparen'>)</span></code></pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8740
8741
8742
8743
8744
8745
8746
8747
8748
8749
8750
8751
8752
8753
8754
8755
8756
8757
8758
8759
8760
8761
8762
8763
8764
8765
8766
8767
8768
8769
8770
8771
8772
8773
8774
8775
8776
8777
8778
8779
8780
8781
8782
8783
8784
8785
8786</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 8740</span>

static VALUE
folevariant_initialize(VALUE self, VALUE args)
{
    int len = 0;
    VARIANT var;
    VALUE val;
    VALUE vvt;
    VARTYPE vt;
    struct olevariantdata *pvar;

    len = RARRAY_LEN(args);
    if (len &lt; 1 || len &gt; 3) {
        rb_raise(rb_eArgError, &quot;wrong number of arguments (%d for 1..3)&quot;, len);
    }
    VariantInit(&amp;var);
    val = rb_ary_entry(args, 0);

    if(!rb_obj_is_kind_of(val, cWIN32OLE) &amp;&amp;
       !rb_obj_is_kind_of(val, cWIN32OLE_VARIANT) &amp;&amp;
       !rb_obj_is_kind_of(val, rb_cTime)) {
	switch (TYPE(val)) {
	case T_ARRAY:
	case T_STRING:
	case T_FIXNUM:
	case T_BIGNUM:
	case T_FLOAT:
	case T_TRUE:
	case T_FALSE:
	case T_NIL:
	    break;
	default:
	    rb_raise(rb_eTypeError, &quot;can not convert WIN32OLE_VARIANT from type %s&quot;,
		     rb_obj_classname(val));
	}
    }

    Data_Get_Struct(self, struct olevariantdata, pvar);
    if (len == 1) {
        ole_val2variant(val, &amp;(pvar-&gt;var));
    } else {
        vvt = rb_ary_entry(args, 1);
        vt = NUM2INT(vvt);
        ole_val2olevariantdata(val, vt, pvar);
    }
    vt = V_VT(&amp;pvar-&gt;var);
    return self;
}</pre>
    </td>
  </tr>
</table>
</div>
  
</div>


  <div id="class_method_details" class="method_details_list">
    <h2>Class Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="array-class_method">
  
    + (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>array</strong>(ary, vt) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Ruby object wrapping OLE variant whose variant type is VT_ARRAY.
The first argument should be Array object which specifies dimensions and
each size of dimensions of OLE array. The second argument specifies variant
type of the element of OLE array.</p>

<p>The following create 2 dimensions OLE array. The first dimensions size is
3, and the second is 4.</p>

<pre class="ruby"><span class="ruby-identifier">ole_ary</span> = <span class="ruby-constant">WIN32OLE_VARIANT</span>.<span class="ruby-identifier">array</span>([<span class="ruby-value">3</span>,<span class="ruby-value">4</span>], <span class="ruby-constant">VT_I4</span>)
<span class="ruby-identifier">ruby_ary</span> = <span class="ruby-identifier">ole_ary</span>.<span class="ruby-identifier">value</span> <span class="ruby-comment"># =&gt; [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]</span>
</pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8672
8673
8674
8675
8676
8677
8678
8679
8680
8681
8682
8683
8684
8685
8686
8687
8688
8689
8690
8691
8692
8693
8694
8695
8696
8697
8698
8699
8700
8701
8702
8703
8704
8705
8706
8707
8708
8709
8710
8711
8712
8713
8714
8715
8716
8717
8718
8719
8720</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 8672</span>

static VALUE
folevariant_s_array(VALUE klass, VALUE elems, VALUE vvt)
{
    VALUE obj = Qnil;
    VARTYPE vt;
    struct olevariantdata *pvar;
    SAFEARRAYBOUND *psab = NULL;
    SAFEARRAY *psa = NULL;
    UINT dim = 0;
    UINT i = 0;

    ole_initialize();

    vt = NUM2UINT(vvt);
    vt = (vt | VT_ARRAY);
    Check_Type(elems, T_ARRAY);
    obj = folevariant_s_allocate(klass);

    Data_Get_Struct(obj, struct olevariantdata, pvar);
    dim = RARRAY_LEN(elems);

    psab = ALLOC_N(SAFEARRAYBOUND, dim);

    if(!psab) {
        rb_raise(rb_eRuntimeError, &quot;memory allocation error&quot;);
    }

    for (i = 0; i &lt; dim; i++) {
        psab[i].cElements = FIX2INT(rb_ary_entry(elems, i));
        psab[i].lLbound = 0;
    }

    psa = SafeArrayCreate((VARTYPE)(vt &amp; VT_TYPEMASK), dim, psab);
    if (psa == NULL) {
        if (psab) free(psab);
        rb_raise(rb_eRuntimeError, &quot;memory allocation error(SafeArrayCreate)&quot;);
    }

    V_VT(&amp;(pvar-&gt;var)) = vt;
    if (vt &amp; VT_BYREF) {
        V_VT(&amp;(pvar-&gt;realvar)) = (vt &amp; ~VT_BYREF);
        V_ARRAY(&amp;(pvar-&gt;realvar)) = psa;
        V_ARRAYREF(&amp;(pvar-&gt;var)) = &amp;(V_ARRAY(&amp;(pvar-&gt;realvar)));
    } else {
        V_ARRAY(&amp;(pvar-&gt;var)) = psa;
    }
    if (psab) free(psab);
    return obj;
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="[]-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>[]</strong>(i, j, ...) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns the element of WIN32OLE_VARIANT object(OLE array). This method is
available only when the variant type of WIN32OLE_VARIANT object is
VT_ARRAY.</p>

<p>REMARK:</p>

<pre class="ruby"><span class="ruby-constant">The</span> <span class="ruby-identifier">all</span> <span class="ruby-identifier">indicies</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-value">0</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">natural</span> <span class="ruby-identifier">number</span> <span class="ruby-keyword">and</span>
<span class="ruby-identifier">lower</span> <span class="ruby-identifier">than</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">equal</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">max</span> <span class="ruby-identifier">indicies</span>.
(<span class="ruby-constant">This</span> <span class="ruby-identifier">point</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">different</span> <span class="ruby-identifier">with</span> <span class="ruby-constant">Ruby</span> <span class="ruby-constant">Array</span> <span class="ruby-identifier">indicies</span>.)

<span class="ruby-identifier">obj</span> = <span class="ruby-constant">WIN32OLE_VARIANT</span>.<span class="ruby-identifier">new</span>([[<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>],[<span class="ruby-value">4</span>,<span class="ruby-value">5</span>,<span class="ruby-value">6</span>]])
<span class="ruby-identifier">p</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">0</span>,<span class="ruby-value">0</span>] <span class="ruby-comment"># =&gt; 1</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">1</span>,<span class="ruby-value">0</span>] <span class="ruby-comment"># =&gt; 4</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">2</span>,<span class="ruby-value">0</span>] <span class="ruby-comment"># =&gt; WIN32OLERuntimeError</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">obj</span>[<span class="ruby-value">0</span>, <span class="ruby-value">-1</span>] <span class="ruby-comment"># =&gt; WIN32OLERuntimeError</span>
</pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8859
8860
8861
8862
8863
8864
8865
8866
8867
8868
8869
8870
8871
8872
8873
8874
8875
8876
8877
8878
8879
8880
8881
8882
8883
8884
8885
8886
8887
8888
8889
8890
8891
8892</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 8859</span>

static VALUE
folevariant_ary_aref(int argc, VALUE *argv, VALUE self)
{
    struct olevariantdata *pvar;
    SAFEARRAY *psa;
    VALUE val = Qnil;
    VARIANT variant;
    long *pid;
    HRESULT hr;

    Data_Get_Struct(self, struct olevariantdata, pvar);
    if (!V_ISARRAY(&amp;(pvar-&gt;var))) {
        rb_raise(eWIN32OLERuntimeError,
                 &quot;`[]' is not available for this variant type object&quot;);
    }
    psa = get_locked_safe_array(self);
    if (psa == NULL) {
        return val;
    }

    pid = ary2safe_array_index(argc, argv, psa);

    VariantInit(&amp;variant);
    V_VT(&amp;variant) = (V_VT(&amp;(pvar-&gt;var)) &amp; ~VT_ARRAY) | VT_BYREF;
    hr = SafeArrayPtrOfIndex(psa, pid, &amp;V_BYREF(&amp;variant));
    if (FAILED(hr)) {
        ole_raise(hr, eWIN32OLERuntimeError, &quot;failed to SafeArrayPtrOfIndex&quot;);
    }
    val = ole_variant2val(&amp;variant);

    unlock_safe_array(psa);
    if (pid) free(pid);
    return val;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="[]=-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>[]=</strong>(i, j, ...) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Set the element of WIN32OLE_VARIANT object(OLE array) to val. This method
is available only when the variant type of WIN32OLE_VARIANT object is
VT_ARRAY.</p>

<p>REMARK:</p>

<pre class="ruby"><span class="ruby-constant">The</span> <span class="ruby-identifier">all</span> <span class="ruby-identifier">indicies</span> <span class="ruby-identifier">should</span> <span class="ruby-identifier">be</span> <span class="ruby-value">0</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">natural</span> <span class="ruby-identifier">number</span> <span class="ruby-keyword">and</span>
<span class="ruby-identifier">lower</span> <span class="ruby-identifier">than</span> <span class="ruby-keyword">or</span> <span class="ruby-identifier">equal</span> <span class="ruby-identifier">to</span> <span class="ruby-identifier">max</span> <span class="ruby-identifier">indicies</span>.
(<span class="ruby-constant">This</span> <span class="ruby-identifier">point</span> <span class="ruby-identifier">is</span> <span class="ruby-identifier">different</span> <span class="ruby-identifier">with</span> <span class="ruby-constant">Ruby</span> <span class="ruby-constant">Array</span> <span class="ruby-identifier">indicies</span>.)

<span class="ruby-identifier">obj</span> = <span class="ruby-constant">WIN32OLE_VARIANT</span>.<span class="ruby-identifier">new</span>([[<span class="ruby-value">1</span>,<span class="ruby-value">2</span>,<span class="ruby-value">3</span>],[<span class="ruby-value">4</span>,<span class="ruby-value">5</span>,<span class="ruby-value">6</span>]])
<span class="ruby-identifier">obj</span>[<span class="ruby-value">0</span>,<span class="ruby-value">0</span>] = <span class="ruby-value">7</span>
<span class="ruby-identifier">obj</span>[<span class="ruby-value">1</span>,<span class="ruby-value">0</span>] = <span class="ruby-value">8</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span> <span class="ruby-comment"># =&gt; [[7,2,3], [8,5,6]]</span>
<span class="ruby-identifier">obj</span>[<span class="ruby-value">2</span>,<span class="ruby-value">0</span>] = <span class="ruby-value">9</span> <span class="ruby-comment"># =&gt; WIN32OLERuntimeError</span>
<span class="ruby-identifier">obj</span>[<span class="ruby-value">0</span>, <span class="ruby-value">-1</span>] = <span class="ruby-value">9</span> <span class="ruby-comment"># =&gt; WIN32OLERuntimeError</span>
</pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8939
8940
8941
8942
8943
8944
8945
8946
8947
8948
8949
8950
8951
8952
8953
8954
8955
8956
8957
8958
8959
8960
8961
8962
8963
8964
8965
8966
8967
8968
8969
8970
8971
8972
8973
8974
8975
8976
8977</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 8939</span>

static VALUE
folevariant_ary_aset(int argc, VALUE *argv, VALUE self)
{
    struct olevariantdata *pvar;
    SAFEARRAY *psa;
    VARIANT var;
    VARTYPE vt;
    long *pid;
    HRESULT hr;
    VOID *p = NULL;

    Data_Get_Struct(self, struct olevariantdata, pvar);
    if (!V_ISARRAY(&amp;(pvar-&gt;var))) {
        rb_raise(eWIN32OLERuntimeError,
                 &quot;`[]' is not available for this variant type object&quot;);
    }
    psa = get_locked_safe_array(self);
    if (psa == NULL) {
        rb_raise(rb_eRuntimeError, &quot;failed to get SafeArray pointer&quot;);
    }

    pid = ary2safe_array_index(argc-1, argv, psa);

    VariantInit(&amp;var);
    vt = (V_VT(&amp;(pvar-&gt;var)) &amp; ~VT_ARRAY);
    p = val2variant_ptr(argv[argc-1], &amp;var, vt);
    if ((V_VT(&amp;var) == VT_DISPATCH &amp;&amp; V_DISPATCH(&amp;var) == NULL) ||
        (V_VT(&amp;var) == VT_UNKNOWN &amp;&amp; V_UNKNOWN(&amp;var) == NULL)) {
        rb_raise(eWIN32OLERuntimeError, &quot;argument does not have IDispatch or IUnknown Interface&quot;);
    }
    hr = SafeArrayPutElement(psa, pid, p);
    if (FAILED(hr)) {
        ole_raise(hr, eWIN32OLERuntimeError, &quot;failed to SafeArrayPutElement&quot;);
    }

    unlock_safe_array(psa);
    if (pid) free(pid);
    return argv[argc-1];
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>value</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns Ruby object value from OLE variant.</p>

<pre class="ruby"><span class="ruby-identifier">obj</span> = <span class="ruby-constant">WIN32OLE_VARIANT</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">1</span>, <span class="ruby-constant">WIN32OLE</span><span class="ruby-operator">::</span><span class="ruby-constant">VARIANT</span><span class="ruby-operator">::</span><span class="ruby-constant">VT_BSTR</span>)
<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span> <span class="ruby-comment"># =&gt; &quot;1&quot; (not Fixnum object, but String object &quot;1&quot;)</span>
</pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


8988
8989
8990
8991
8992
8993
8994
8995
8996
8997
8998
8999
9000
9001
9002
9003
9004
9005
9006
9007
9008
9009
9010
9011
9012
9013
9014
9015
9016</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 8988</span>

static VALUE
folevariant_value(VALUE self)
{
    struct olevariantdata *pvar;
    VALUE val = Qnil;
    VARTYPE vt;
    int dim;
    SAFEARRAY *psa;
    Data_Get_Struct(self, struct olevariantdata, pvar);

    val = ole_variant2val(&amp;(pvar-&gt;var));
    vt = V_VT(&amp;(pvar-&gt;var));

    if ((vt &amp; ~VT_BYREF) == (VT_UI1|VT_ARRAY)) {
        if (vt &amp; VT_BYREF) {
            psa = *V_ARRAYREF(&amp;(pvar-&gt;var));
        } else {
            psa  = V_ARRAY(&amp;(pvar-&gt;var));
        }
        if (!psa) {
            return val;
        }
        dim = SafeArrayGetDim(psa);
        if (dim == 1) {
            val = rb_funcall(val, rb_intern(&quot;pack&quot;), 1, rb_str_new2(&quot;C*&quot;));
        }
    }
    return val;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="value=-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>value=</strong>(val) 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Sets variant value to val. If the val type does not match variant value
type(vartype), then val is changed to match variant value type(vartype)
before setting val. Thie method is not available when vartype is
VT_ARRAY(except VT_UI1|VT_ARRAY). If the vartype is VT_UI1|VT_ARRAY, the
val should be String object.</p>

<pre class="ruby"><span class="ruby-identifier">obj</span> = <span class="ruby-constant">WIN32OLE_VARIANT</span>.<span class="ruby-identifier">new</span>(<span class="ruby-value">1</span>) <span class="ruby-comment"># obj.vartype is WIN32OLE::VARIANT::VT_I4</span>
<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span> = <span class="ruby-value">3.2</span> <span class="ruby-comment"># 3.2 is changed to 3 when setting value.</span>
<span class="ruby-identifier">p</span> <span class="ruby-identifier">obj</span>.<span class="ruby-identifier">value</span> <span class="ruby-comment"># =&gt; 3</span>
</pre>


  </div>
</div>
<div class="tags">
  
  


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9049
9050
9051
9052
9053
9054
9055
9056
9057
9058
9059
9060
9061
9062</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 9049</span>

static VALUE
folevariant_set_value(VALUE self, VALUE val)
{
    struct olevariantdata *pvar;
    VARTYPE vt;
    Data_Get_Struct(self, struct olevariantdata, pvar);
    vt = V_VT(&amp;(pvar-&gt;var));
    if (V_ISARRAY(&amp;(pvar-&gt;var)) &amp;&amp; ((vt &amp; ~VT_BYREF) != (VT_UI1|VT_ARRAY) || TYPE(val) != T_STRING)) {
        rb_raise(eWIN32OLERuntimeError,
                 &quot;`value=' is not available for this variant type object&quot;);
    }
    ole_val2olevariantdata(val, vt, pvar);
    return Qnil;
}</pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="vartype-instance_method">
  
    - (<tt><span class='object_link'><a href="Object.html" title="Object (class)">Object</a></span></tt>) <strong>vartype</strong> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Returns OLE variant type.</p>

<pre class="ruby"><span class="ruby-identifier">obj</span> = <span class="ruby-constant">WIN32OLE_VARIANT</span>.<span class="ruby-identifier">new</span>(<span class="ruby-string">&quot;string&quot;</span>)
<span class="ruby-identifier">obj</span>.<span class="ruby-identifier">vartype</span> <span class="ruby-comment"># =&gt; WIN32OLE::VARIANT::VT_BSTR</span>
</pre>


  </div>
</div>
<div class="tags">
  

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


9027
9028
9029
9030
9031
9032
9033</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'ext/win32ole/win32ole.c', line 9027</span>

static VALUE
folevariant_vartype(VALUE self)
{
    struct olevariantdata *pvar;
    Data_Get_Struct(self, struct olevariantdata, pvar);
    return INT2FIX(V_VT(&amp;pvar-&gt;var));
}</pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

    <div id="footer">
  Generated on Wed Nov 19 10:17:07 2014 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.8.7.4 (ruby-1.9.3).
</div>

  </body>
</html>